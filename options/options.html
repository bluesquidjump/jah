<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>JAH Settings</title>
  <link rel="stylesheet" href="options.css">
</head>
<body>
  <div class="options-container">
    <header class="options-header">
      <h1>JAH Settings</h1>
      <p class="subtitle">JA4 Hash Enrichment Configuration</p>
    </header>

    <main>
      <!-- API Configuration -->
      <section class="settings-section">
        <h2>Claude API Configuration</h2>

        <div class="form-group">
          <label for="api-key">API Key</label>
          <div class="input-with-button">
            <input type="password" id="api-key" placeholder="sk-ant-api03-..." autocomplete="off">
            <button type="button" id="toggle-key" class="btn btn-icon" title="Show/Hide">üëÅ</button>
          </div>
          <p class="help-text">
            Your Anthropic API key. Get one at
            <a href="https://console.anthropic.com/" target="_blank" rel="noopener">console.anthropic.com</a>
          </p>
        </div>

        <div class="form-group">
          <label for="model-select">Model</label>
          <select id="model-select">
            <option value="claude-sonnet-4-20250514">Claude Sonnet 4 (Recommended)</option>
            <option value="claude-opus-4-20250514">Claude Opus 4 (Most capable)</option>
            <option value="claude-haiku-3-5-20241022">Claude Haiku 3.5 (Fastest)</option>
          </select>
          <p class="help-text">Select which Claude model to use for analysis.</p>
        </div>

        <div class="form-actions">
          <button type="button" id="test-connection" class="btn btn-secondary">
            Test Connection
          </button>
          <span id="connection-status" class="status-badge hidden"></span>
        </div>
      </section>

      <!-- External Integrations -->
      <section class="settings-section">
        <h2>External Integrations</h2>
        <p class="section-description">
          Connect to external services for enhanced fingerprint enrichment.
          These integrations provide additional threat intelligence and search capabilities.
        </p>

        <!-- Brave Search -->
        <div class="integration-card">
          <div class="integration-header">
            <h3>Brave Search API</h3>
            <span class="integration-status" id="brave-status">Not configured</span>
          </div>
          <p class="integration-description">
            Search the web for fingerprint information, threat reports, and research.
          </p>
          <div class="form-group">
            <label for="brave-api-key">Brave Search API Key</label>
            <div class="input-with-button">
              <input type="password" id="brave-api-key" placeholder="BSA..." autocomplete="off">
              <button type="button" class="btn btn-icon toggle-visibility" data-target="brave-api-key">üëÅ</button>
            </div>
            <p class="help-text">
              Get an API key at <a href="https://brave.com/search/api/" target="_blank" rel="noopener">brave.com/search/api</a>
            </p>
          </div>
        </div>

        <!-- VirusTotal -->
        <div class="integration-card">
          <div class="integration-header">
            <h3>VirusTotal</h3>
            <span class="integration-status" id="vt-status">Not configured</span>
          </div>
          <p class="integration-description">
            Search VirusTotal for malware samples associated with fingerprints.
          </p>
          <div class="form-group">
            <label for="vt-api-key">VirusTotal API Key</label>
            <div class="input-with-button">
              <input type="password" id="vt-api-key" placeholder="Enter your VT API key..." autocomplete="off">
              <button type="button" class="btn btn-icon toggle-visibility" data-target="vt-api-key">üëÅ</button>
            </div>
            <p class="help-text">
              Get an API key at <a href="https://www.virustotal.com/gui/join-us" target="_blank" rel="noopener">virustotal.com</a>
            </p>
          </div>
        </div>

        <!-- Shodan -->
        <div class="integration-card">
          <div class="integration-header">
            <h3>Shodan</h3>
            <span class="integration-status" id="shodan-status">Not configured</span>
          </div>
          <p class="integration-description">
            Search Shodan for hosts using specific TLS fingerprints.
          </p>
          <div class="form-group">
            <label for="shodan-api-key">Shodan API Key</label>
            <div class="input-with-button">
              <input type="password" id="shodan-api-key" placeholder="Enter your Shodan API key..." autocomplete="off">
              <button type="button" class="btn btn-icon toggle-visibility" data-target="shodan-api-key">üëÅ</button>
            </div>
            <p class="help-text">
              Get an API key at <a href="https://account.shodan.io/" target="_blank" rel="noopener">shodan.io</a>
            </p>
          </div>
        </div>

        <!-- AlienVault OTX -->
        <div class="integration-card">
          <div class="integration-header">
            <h3>AlienVault OTX</h3>
            <span class="integration-status" id="otx-status">Not configured</span>
          </div>
          <p class="integration-description">
            Query AlienVault Open Threat Exchange for file hash intelligence and pulse reports.
          </p>
          <div class="form-group">
            <label for="otx-api-key">OTX API Key</label>
            <div class="input-with-button">
              <input type="password" id="otx-api-key" placeholder="Enter your OTX API key..." autocomplete="off">
              <button type="button" class="btn btn-icon toggle-visibility" data-target="otx-api-key">üëÅ</button>
            </div>
            <p class="help-text">
              Get a free API key at <a href="https://otx.alienvault.com/" target="_blank" rel="noopener">otx.alienvault.com</a>
            </p>
          </div>
        </div>

        <!-- MalwareBazaar note -->
        <div class="integration-card">
          <div class="integration-header">
            <h3>MalwareBazaar</h3>
            <span class="integration-status status-configured">No key required</span>
          </div>
          <p class="integration-description">
            MalwareBazaar (abuse.ch) is queried automatically for file hash lookups. No API key is needed.
          </p>
        </div>

        <div class="privacy-notice">
          <p><strong>Privacy:</strong> File hashes detected on pages you visit will be sent to configured
          threat intelligence services for enrichment. Only the hash string is transmitted &mdash; never
          page URLs or user data.</p>
        </div>
      </section>

      <!-- Data Management -->
      <section class="settings-section">
        <h2>Data Management</h2>

        <div class="data-actions">
          <div class="data-action">
            <div class="action-info">
              <h3>Enrichment History</h3>
              <p id="history-count">0 lookups stored</p>
            </div>
            <button type="button" id="clear-history" class="btn btn-danger btn-small">
              Clear History
            </button>
          </div>

          <div class="data-action">
            <div class="action-info">
              <h3>Export Settings</h3>
              <p>Download all settings and history</p>
            </div>
            <button type="button" id="export-data" class="btn btn-secondary btn-small">
              Export
            </button>
          </div>

          <div class="data-action">
            <div class="action-info">
              <h3>Import Settings</h3>
              <p>Restore from a backup file</p>
            </div>
            <input type="file" id="import-file" accept=".json" hidden>
            <button type="button" id="import-data" class="btn btn-secondary btn-small">
              Import
            </button>
          </div>
        </div>
      </section>

      <!-- About -->
      <section class="settings-section">
        <h2>About</h2>
        <div class="about-info">
          <p><strong>JAH - JA4 Hash Enrichment</strong></p>
          <p>Version 1.0.0</p>
          <p class="about-description">
            A Firefox extension for analyzing JA4 fingerprint hashes using Claude AI.
            JA4 fingerprints help identify TLS clients, servers, HTTP clients,
            certificates, SSH sessions, and TCP implementations.
          </p>
          <div class="about-links">
            <a href="https://github.com/FoxIO-LLC/ja4" target="_blank" rel="noopener">
              JA4 Specification
            </a>
            <a href="https://ja4db.com/" target="_blank" rel="noopener">
              JA4 Database
            </a>
          </div>
        </div>
      </section>
    </main>

    <footer class="options-footer">
      <button type="button" id="save-settings" class="btn btn-primary">
        Save Settings
      </button>
      <span id="save-status" class="status-message hidden"></span>
    </footer>
  </div>

  <script src="options.js"></script>
</body>
</html>
